<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä–µ–¥–∏—Ç—ã - –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –°–∏—Å—Ç–µ–º–∞</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 1rem 2rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .header h1 { font-size: 1.5rem; }
        .nav-links { display: flex; gap: 1rem; }
        .nav-links a {
            color: white; text-decoration: none; padding: 0.5rem 1rem;
            border-radius: 5px; transition: background 0.3s;
        }
        .nav-links a:hover { background: rgba(255,255,255,0.2); }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 2rem; }
        .card {
            background: white; padding: 2rem; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 2rem;
        }
        .card h2 { margin-bottom: 1.5rem; color: #333; }
        .loan-types {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem; margin-bottom: 2rem;
        }
        .loan-type-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 1.5rem; border-radius: 10px; cursor: pointer; transition: transform 0.3s;
        }
        .loan-type-card:hover { transform: translateY(-5px); }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; color: #555; font-weight: 500; }
        input, select {
            width: 100%; padding: 0.75rem; border: 1px solid #ddd;
            border-radius: 5px; font-size: 1rem;
        }
        button.primary {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; border-radius: 5px;
            font-size: 1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s;
        }
        button.primary:hover { transform: translateY(-2px); }
        .message {
            padding: 0.75rem; border-radius: 5px; margin-bottom: 1rem; display: none;
        }
        .message.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .message.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loan-item {
            padding: 1.5rem; border: 1px solid #eee;
            border-radius: 8px; margin-bottom: 1rem;
        }
        .loan-header {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 1rem;
        }
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.85rem; font-weight: 600; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-approved { background: #d1ecf1; color: #0c5460; }
        .status-active { background: #d4edda; color: #155724; }
        .status-rejected { background: #f8d7da; color: #721c24; }
        .status-closed { background: #e2e3e5; color: #383d41; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
        .info-label { font-size: 0.85rem; color: #666; }
        .info-value { font-size: 1.1rem; font-weight: 600; }
        .loading { text-align: center; padding: 2rem; color: #666; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè¶ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –°–∏—Å—Ç–µ–º–∞ - –ö—Ä–µ–¥–∏—Ç—ã</h1>
        <div class="nav-links">
            <a href="dashboard.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="deposits.html">–î–µ–ø–æ–∑–∏—Ç—ã</a>
            <a href="index.html" onclick="logout()">–í—ã–π—Ç–∏</a>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫—Ä–µ–¥–∏—Ç–∞</h2>
            <div class="loan-types">
                <div class="loan-type-card">
                    <h3>üí∞ –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–π</h3>
                    <p>–°—Ç–∞–≤–∫–∞ 12.5% –≥–æ–¥–æ–≤—ã—Ö</p>
                </div>
                <div class="loan-type-card">
                    <h3>üè† –ò–ø–æ—Ç–µ–∫–∞</h3>
                    <p>–°—Ç–∞–≤–∫–∞ 12.5% –≥–æ–¥–æ–≤—ã—Ö</p>
                </div>
                <div class="loan-type-card">
                    <h3>üöó –ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç</h3>
                    <p>–°—Ç–∞–≤–∫–∞ 12.5% –≥–æ–¥–æ–≤—ã—Ö</p>
                </div>
                <div class="loan-type-card">
                    <h3>üíº –ë–∏–∑–Ω–µ—Å</h3>
                    <p>–°—Ç–∞–≤–∫–∞ 12.5% –≥–æ–¥–æ–≤—ã—Ö</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>–ó–∞—è–≤–∫–∞ –Ω–∞ –∫—Ä–µ–¥–∏—Ç</h2>
            <div id="loanMessage" class="message"></div>
            <form id="loanForm">
                <div class="form-group">
                    <label for="accountId">–°—á—ë—Ç –¥–ª—è –∑–∞—á–∏—Å–ª–µ–Ω–∏—è:</label>
                    <select id="accountId" required>
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å—á—ë—Ç --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="amount">–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞:</label>
                    <input type="number" id="amount" min="10000" step="1000" placeholder="–ú–∏–Ω–∏–º—É–º 10 000" required>
                </div>
                <div class="form-group">
                    <label for="durationMonths">–°—Ä–æ–∫ (–º–µ—Å—è—Ü–µ–≤):</label>
                    <select id="durationMonths" required>
                        <option value="6">6 –º–µ—Å—è—Ü–µ–≤</option>
                        <option value="12" selected>12 –º–µ—Å—è—Ü–µ–≤</option>
                        <option value="24">24 –º–µ—Å—è—Ü–∞</option>
                        <option value="36">36 –º–µ—Å—è—Ü–µ–≤</option>
                        <option value="60">60 –º–µ—Å—è—Ü–µ–≤</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="currency">–í–∞–ª—é—Ç–∞:</label>
                    <select id="currency" required>
                        <option value="RUB">RUB - –†—É–±–ª—å</option>
                        <option value="USD">USD - –î–æ–ª–ª–∞—Ä</option>
                        <option value="EUR">EUR - –ï–≤—Ä–æ</option>
                    </select>
                </div>
                <button type="submit" class="primary">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
            </form>
        </div>

        <div class="card">
            <h2>–ú–æ–∏ –∫—Ä–µ–¥–∏—Ç—ã</h2>
            <div id="loansList">
                <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';
        const token = localStorage.getItem('token');

        if (!token) window.location.href = 'index.html';

        window.addEventListener('load', () => {
            loadAccounts();
            loadLoans();
        });

        async function loadAccounts() {
            try {
                const res = await fetch(`${API_BASE}/accounts`, {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                if (!res.ok) { if (res.status === 401) { localStorage.clear(); window.location.href = 'login.html'; } return; }
                const accounts = await res.json();
                const sel = document.getElementById('accountId');
                accounts.forEach(a => {
                    const opt = document.createElement('option');
                    opt.value = a.id;
                    opt.textContent = `${a.accountNumber} ‚Äî ${a.balance} ${a.currency}`;
                    sel.appendChild(opt);
                });
            } catch (e) { console.error(e); }
        }

        document.getElementById('loanForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const body = {
                accountId: parseInt(document.getElementById('accountId').value),
                amount: parseFloat(document.getElementById('amount').value),
                durationMonths: parseInt(document.getElementById('durationMonths').value),
                currency: document.getElementById('currency').value
            };
            try {
                const res = await fetch(`${API_BASE}/loans`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify(body)
                });
                const data = await res.json();
                if (res.ok) {
                    showMessage('loanMessage', '–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∞–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è.', 'success');
                    document.getElementById('loanForm').reset();
                    loadLoans();
                } else {
                    showMessage('loanMessage', data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∞—á–µ –∑–∞—è–≤–∫–∏', 'error');
                }
            } catch (e) {
                showMessage('loanMessage', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            }
        });

        async function loadLoans() {
            const list = document.getElementById('loansList');
            try {
                const res = await fetch(`${API_BASE}/loans`, {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                if (!res.ok) { list.innerHTML = '<p class="loading" style="color:red">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>'; return; }
                const loans = await res.json();
                if (!loans.length) { list.innerHTML = '<p class="loading">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—Ä–µ–¥–∏—Ç–æ–≤</p>'; return; }
                list.innerHTML = loans.map(l => `
                    <div class="loan-item">
                        <div class="loan-header">
                            <div>
                                <strong>–ö—Ä–µ–¥–∏—Ç ‚Ññ ${l.loanNumber}</strong>
                                <div style="font-size:0.9rem;color:#666">–û—Ç–∫—Ä—ã—Ç: ${l.startDate || '‚Äî'}</div>
                            </div>
                            <span class="status-badge status-${(l.status||'').toLowerCase()}">${getStatusName(l.status)}</span>
                        </div>
                        <div class="info-grid">
                            <div><div class="info-label">–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞</div><div class="info-value">${l.principalAmount} ${l.currency}</div></div>
                            <div><div class="info-label">–û—Å—Ç–∞—Ç–æ–∫ –¥–æ–ª–≥–∞</div><div class="info-value">${l.remainingAmount} ${l.currency}</div></div>
                            <div><div class="info-label">–°—Ç–∞–≤–∫–∞</div><div class="info-value">${l.interestRate}%</div></div>
                            <div><div class="info-label">–°—Ä–æ–∫</div><div class="info-value">${l.durationMonths} –º–µ—Å.</div></div>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                list.innerHTML = '<p class="loading" style="color:red">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤</p>';
            }
        }

        function getStatusName(status) {
            const names = { PENDING: '–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏', APPROVED: '–û–¥–æ–±—Ä–µ–Ω', ACTIVE: '–ê–∫—Ç–∏–≤–µ–Ω', REJECTED: '–û—Ç–∫–ª–æ–Ω—ë–Ω', CLOSED: '–ó–∞–∫—Ä—ã—Ç' };
            return names[status] || status;
        }

        function showMessage(id, text, type) {
            const el = document.getElementById(id);
            el.textContent = text; el.className = `message ${type}`; el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function logout() { localStorage.clear(); }
    </script>
</body>
</html>

