<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ–ø–æ–∑–∏—Ç—ã - –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –°–∏—Å—Ç–µ–º–∞</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white; padding: 1rem 2rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .header h1 { font-size: 1.5rem; }
        .nav-links { display: flex; gap: 1rem; }
        .nav-links a {
            color: white; text-decoration: none; padding: 0.5rem 1rem;
            border-radius: 5px; transition: background 0.3s;
        }
        .nav-links a:hover { background: rgba(255,255,255,0.2); }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 2rem; }
        .card {
            background: white; padding: 2rem; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 2rem;
        }
        .card h2 { margin-bottom: 1.5rem; color: #333; }
        .deposit-offers {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem; margin-bottom: 2rem;
        }
        .deposit-offer-card {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white; padding: 2rem; border-radius: 10px; text-align: center;
        }
        .deposit-rate { font-size: 3rem; font-weight: bold; margin: 1rem 0; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; color: #555; font-weight: 500; }
        input, select {
            width: 100%; padding: 0.75rem; border: 1px solid #ddd;
            border-radius: 5px; font-size: 1rem;
        }
        button.primary {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white; border: none; border-radius: 5px;
            font-size: 1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s;
        }
        button.primary:hover { transform: translateY(-2px); }
        button.danger {
            padding: 0.4rem 0.9rem; background: #dc3545;
            color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.85rem;
        }
        .message {
            padding: 0.75rem; border-radius: 5px; margin-bottom: 1rem; display: none;
        }
        .message.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .message.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .deposit-item {
            padding: 1.5rem; border: 1px solid #eee;
            border-radius: 8px; margin-bottom: 1rem;
        }
        .deposit-header {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 1rem;
        }
        .status-active { padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.85rem; font-weight: 600; background: #d4edda; color: #155724; }
        .status-closed { padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.85rem; font-weight: 600; background: #e2e3e5; color: #383d41; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
        .info-label { font-size: 0.85rem; color: #666; }
        .info-value { font-size: 1.1rem; font-weight: 600; }
        .loading { text-align: center; padding: 2rem; color: #666; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üí∞ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –°–∏—Å—Ç–µ–º–∞ - –î–µ–ø–æ–∑–∏—Ç—ã</h1>
        <div class="nav-links">
            <a href="dashboard.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="loans.html">–ö—Ä–µ–¥–∏—Ç—ã</a>
            <a href="index.html" onclick="logout()">–í—ã–π—Ç–∏</a>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <h2>–ù–∞—à–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h2>
            <div class="deposit-offers">
                <div class="deposit-offer-card">
                    <h3>üìä –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π</h3>
                    <div class="deposit-rate">5%</div>
                    <p>–ì–æ–¥–æ–≤—ã—Ö ¬∑ 6 –º–µ—Å—è—Ü–µ–≤</p>
                </div>
                <div class="deposit-offer-card">
                    <h3>‚≠ê –ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π</h3>
                    <div class="deposit-rate">7%</div>
                    <p>–ì–æ–¥–æ–≤—ã—Ö ¬∑ 12 –º–µ—Å—è—Ü–µ–≤</p>
                </div>
                <div class="deposit-offer-card">
                    <h3>üíé VIP</h3>
                    <div class="deposit-rate">9%</div>
                    <p>–ì–æ–¥–æ–≤—ã—Ö ¬∑ 24 –º–µ—Å—è—Ü–∞</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>–û—Ç–∫—Ä—ã—Ç—å –¥–µ–ø–æ–∑–∏—Ç</h2>
            <div id="depositMessage" class="message"></div>
            <form id="depositForm">
                <div class="form-group">
                    <label for="accountId">–°—á—ë—Ç –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞:</label>
                    <select id="accountId" required>
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å—á—ë—Ç --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="amount">–°—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–∞:</label>
                    <input type="number" id="amount" min="1000" step="100" placeholder="–ú–∏–Ω–∏–º—É–º 1000" required>
                </div>
                <div class="form-group">
                    <label for="durationMonths">–°—Ä–æ–∫ (–º–µ—Å—è—Ü–µ–≤):</label>
                    <select id="durationMonths" required>
                        <option value="3">3 –º–µ—Å—è—Ü–∞</option>
                        <option value="6" selected>6 –º–µ—Å—è—Ü–µ–≤</option>
                        <option value="12">12 –º–µ—Å—è—Ü–µ–≤</option>
                        <option value="24">24 –º–µ—Å—è—Ü–∞</option>
                        <option value="36">36 –º–µ—Å—è—Ü–µ–≤</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="currency">–í–∞–ª—é—Ç–∞:</label>
                    <select id="currency" required>
                        <option value="RUB">RUB - –†—É–±–ª—å</option>
                        <option value="USD">USD - –î–æ–ª–ª–∞—Ä</option>
                        <option value="EUR">EUR - –ï–≤—Ä–æ</option>
                    </select>
                </div>
                <button type="submit" class="primary">–û—Ç–∫—Ä—ã—Ç—å –¥–µ–ø–æ–∑–∏—Ç</button>
            </form>
        </div>

        <div class="card">
            <h2>–ú–æ–∏ –¥–µ–ø–æ–∑–∏—Ç—ã</h2>
            <div id="depositsList">
                <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';
        const token = localStorage.getItem('token');

        if (!token) window.location.href = 'index.html';

        window.addEventListener('load', () => {
            loadAccounts();
            loadDeposits();
        });

        async function loadAccounts() {
            try {
                const res = await fetch(`${API_BASE}/accounts`, {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                if (!res.ok) { if (res.status === 401) { localStorage.clear(); window.location.href = 'login.html'; } return; }
                const accounts = await res.json();
                const sel = document.getElementById('accountId');
                accounts.forEach(a => {
                    const opt = document.createElement('option');
                    opt.value = a.id;
                    opt.textContent = `${a.accountNumber} ‚Äî ${a.balance} ${a.currency}`;
                    sel.appendChild(opt);
                });
            } catch (e) { console.error(e); }
        }

        document.getElementById('depositForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const body = {
                accountId: parseInt(document.getElementById('accountId').value),
                amount: parseFloat(document.getElementById('amount').value),
                durationMonths: parseInt(document.getElementById('durationMonths').value),
                currency: document.getElementById('currency').value
            };
            try {
                const res = await fetch(`${API_BASE}/deposits`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify(body)
                });
                const data = await res.json();
                if (res.ok) {
                    showMessage('depositMessage', '–î–µ–ø–æ–∑–∏—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫—Ä—ã—Ç!', 'success');
                    document.getElementById('depositForm').reset();
                    loadAccounts();
                    loadDeposits();
                } else {
                    showMessage('depositMessage', data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –¥–µ–ø–æ–∑–∏—Ç–∞', 'error');
                }
            } catch (e) {
                showMessage('depositMessage', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            }
        });

        async function loadDeposits() {
            const list = document.getElementById('depositsList');
            try {
                const res = await fetch(`${API_BASE}/deposits`, {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                if (!res.ok) { list.innerHTML = '<p class="loading" style="color:red">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>'; return; }
                const deposits = await res.json();
                if (!deposits.length) { list.innerHTML = '<p class="loading">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–µ–ø–æ–∑–∏—Ç–æ–≤</p>'; return; }
                list.innerHTML = deposits.map(d => `
                    <div class="deposit-item">
                        <div class="deposit-header">
                            <div>
                                <strong>–î–µ–ø–æ–∑–∏—Ç ‚Ññ ${d.depositNumber}</strong>
                                <div style="font-size:0.9rem;color:#666">–û—Ç–∫—Ä—ã—Ç: ${d.startDate || '‚Äî'}</div>
                            </div>
                            <span class="${d.closedAt ? 'status-closed' : 'status-active'}">${d.closedAt ? '–ó–∞–∫—Ä—ã—Ç' : '–ê–∫—Ç–∏–≤–µ–Ω'}</span>
                        </div>
                        <div class="info-grid">
                            <div><div class="info-label">–°—É–º–º–∞</div><div class="info-value">${d.amount} ${d.currency}</div></div>
                            <div><div class="info-label">–°—Ç–∞–≤–∫–∞</div><div class="info-value">${d.interestRate}%</div></div>
                            <div><div class="info-label">–°—Ä–æ–∫</div><div class="info-value">${d.durationMonths} –º–µ—Å.</div></div>
                            <div><div class="info-label">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</div><div class="info-value">${d.endDate || '‚Äî'}</div></div>
                        </div>
                        ${!d.closedAt ? `<div style="margin-top:1rem"><button class="danger" onclick="closeDeposit(${d.id})">–ó–∞–∫—Ä—ã—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ</button></div>` : ''}
                    </div>
                `).join('');
            } catch (e) {
                list.innerHTML = '<p class="loading" style="color:red">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤</p>';
            }
        }

        async function closeDeposit(id) {
            if (!confirm('–ó–∞–∫—Ä—ã—Ç—å –¥–µ–ø–æ–∑–∏—Ç –¥–æ—Å—Ä–æ—á–Ω–æ?')) return;
            try {
                const res = await fetch(`${API_BASE}/deposits/${id}/close`, {
                    method: 'PUT',
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                if (res.ok) { alert('–î–µ–ø–æ–∑–∏—Ç –∑–∞–∫—Ä—ã—Ç'); loadDeposits(); }
                else { const d = await res.json(); alert(d.message || '–û—à–∏–±–∫–∞'); }
            } catch (e) { alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è'); }
        }

        function showMessage(id, text, type) {
            const el = document.getElementById(id);
            el.textContent = text; el.className = `message ${type}`; el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function logout() { localStorage.clear(); }
    </script>
</body>
</html>

